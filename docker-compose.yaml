services:
  nest-sync:
    build: .
    container_name: nest-telegram-sync
    restart: unless-stopped
    environment:
      - GOOGLE_MASTER_TOKEN=${GOOGLE_MASTER_TOKEN}
      - GOOGLE_USERNAME=${GOOGLE_USERNAME}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHANNEL_ID=${TELEGRAM_CHANNEL_ID}
      - TIMEZONE=${TIMEZONE:-UTC}
      - TIME_FORMAT=${TIME_FORMAT:-24h}
      - FORCE_RESEND_ALL=${FORCE_RESEND_ALL:-false}
      # SDM API (Official Google Nest API for event types)
      - SDM_PROJECT_ID=${SDM_PROJECT_ID}
      - SDM_CLIENT_ID=${SDM_CLIENT_ID}
      - SDM_CLIENT_SECRET=${SDM_CLIENT_SECRET}
      - SDM_REFRESH_TOKEN=${SDM_REFRESH_TOKEN}
      - SDM_SERVICE_ACCOUNT_FILE=${SDM_SERVICE_ACCOUNT_FILE:-service-account.json}
      - SDM_PUBSUB_TOPIC=${SDM_PUBSUB_TOPIC}
    volumes:
      - sent-events:/app  # Named volume for persistence
      - ./service-account.json:/app/service-account.json:ro
    env_file:
      - .env

volumes:
  sent-events:  # Named volume - Docker manages this automatically